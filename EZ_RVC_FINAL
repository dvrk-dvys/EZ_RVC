{"cells":[{"cell_type":"code","execution_count":null,"metadata":{"id":"rceScBPoRZ5V"},"outputs":[],"source":["#@title Clone repository and install requirements\n","\n","#@markdown # Clone repository and install requirements\n","\n","#@markdown\n","\n","#@markdown ### After the execution is completed, the runtime will **automatically restart**\n","\n","#@markdown\n","\n","!git clone https://github.com/dvrk-dvys/EZ_RVC.git\n","%cd /content/EZ_RVC\n","%pip install --upgrade pip setuptools\n","%pip install -r requirements.txt --extra-index-url https://download.pytorch.org/whl/cu118\n","exit()"]},{"cell_type":"code","execution_count":null,"metadata":{"cellView":"form","id":"OXupR3yAp8wM"},"outputs":[],"source":["#@title Mount google drive and select which directories to sync with google drive\n","#@markdown # Mount google drive and select which directories to sync with google drive\n","#@markdown\n","\n","from google.colab import drive\n","drive.mount(\"/content/drive\", force_remount=True)\n","\n","#@markdown Directory to store **necessary files**, dont miss the slash at the endðŸ‘‡.\n","EZ_RVC_data_dir = \"/content/drive/MyDrive/dataset\"  #@param {type:\"string\"}\n","#@markdown By default it will create a `sovits4data/` folder in your google drive.\n","RAW_DIR = EZ_RVC_data_dir + \"raw/\"\n","RESULTS_DIR = EZ_RVC_data_dir + \"results/\"\n","LOGS_DIR = EZ_RVC_data_dir + \"logs/\"\n","SR_DIR = EZ_RVC_data_dir + \"logs/44k/\"\n","\n","\n","#@markdown ### These folders will be synced with your google drvie\n","#@markdownã€€### **Strongly recommend to check all.**\n","#@markdown Sync **input audios** and **output audios**\n","sync_raw_and_results = True  #@param {type:\"boolean\"}\n","if sync_raw_and_results:\n","  !mkdir -p {RAW_DIR}\n","  !mkdir -p {RESULTS_DIR}\n","  !rm -rf /content/EZ_RVC/raw\n","  !rm -rf /content/EZ_RVC/results\n","  !ln -s {RAW_DIR} /content/EZ_RVC/raw\n","  !ln -s {RESULTS_DIR} /content/EZ_RVC/results\n","\n","#@markdown Sync **config** and **models**\n","sync_configs_and_logs = True  #@param {type:\"boolean\"}\n","if sync_configs_and_logs:\n","    !mkdir -p {LOGS_DIR}\n","\n","\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"G_PMPCN6wvgZ"},"outputs":[],"source":["#@title Get pretrained model(Optional but strongly recommend).\n","\n","#@markdown # Get pretrained model(Optional but strongly recommend).\n","\n","#@markdown\n","\n","#@markdown - Pre-trained model files: `G_0.pth` `D_0.pth`\n","#@markdown   - Place them under /sovits4data/logs/44k/ in your google drive manualy\n","\n","#@markdown Get them from svc-develop-team(TBD) or anywhere else.\n","\n","#@markdown Although the pretrained model generally does not cause any copyright problems, please pay attention to it. For example, ask the author in advance, or the author has indicated the feasible use in the description clearly.\n","\n","download_pretrained_model = True #@param {type:\"boolean\"}\n","D_0_URL = \"https://huggingface.co/1asbgdh/sovits4.0-volemb-vec768/resolve/main/clean_D_320000.pth\" # @param [\"https://huggingface.co/datasets/ms903/sovits4.0-768vec-layer12/resolve/main/sovits_768l12_pre_large_320k/clean_D_320000.pth\", \"https://huggingface.co/1asbgdh/sovits4.0-volemb-vec768/resolve/main/clean_D_320000.pth\", \"https://huggingface.co/datasets/ms903/sovits4.0-768vec-layer12/resolve/main/vol_emb/clean_D_320000.pth\", \"https://drive.google.com/file/d/1-rtgMwfsWyBVuZVpoIxtTrdLHkEmtm_m/view?usp=drive_link\"] {allow-input: true}\n","G_0_URL = \"https://huggingface.co/1asbgdh/sovits4.0-volemb-vec768/resolve/main/clean_G_320000.pth\" # @param [\"https://huggingface.co/datasets/ms903/sovits4.0-768vec-layer12/resolve/main/sovits_768l12_pre_large_320k/clean_G_320000.pth\", \"https://huggingface.co/1asbgdh/sovits4.0-volemb-vec768/resolve/main/clean_G_320000.pth\", \"https://huggingface.co/datasets/ms903/sovits4.0-768vec-layer12/resolve/main/vol_emb/clean_G_320000.pth\", \"https://drive.google.com/file/d/1-iRmVbvURPsVNS8KPwN2BjAouwAVj0af/view?usp=drive_link\"] {allow-input: true}\n","\n","download_pretrained_diffusion_model = False #@param {type:\"boolean\"}\n","diff_model_URL = \"https://huggingface.co/datasets/ms903/Diff-SVC-refactor-pre-trained-model/resolve/main/fix_pitch_add_vctk_600k/model_0.pt\" #@param {type:\"string\"}\n","\n","%cd /content/EZ_RVC\n","\n","if download_pretrained_model:\n","    !curl -L {D_0_URL} -o logs/44k/D_0.pth\n","    !md5sum logs/44k/D_0.pth\n","    !curl -L {G_0_URL} -o logs/44k/G_0.pth\n","    !md5sum logs/44k/G_0.pth\n","\n","if download_pretrained_diffusion_model:\n","    !mkdir -p logs/44k/diffusion\n","    !curl -L {diff_model_URL} -o logs/44k/diffusion/model_0.pt\n","    !md5sum logs/44k/diffusion/model_0.pt"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"11QgbSNQQQEQ"},"outputs":[],"source":["!ls"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"50jLaankncdS"},"outputs":[],"source":["#@title Start training\n","\n","#@markdown # Start training\n","\n","#@markdown If you want to use pre-trained models, upload them to /sovits4data/logs/44k/ in your google drive manualy.\n","\n","#@markdown\n","\n","# %cd /content/EZ_RVC\n","# %cd /content/\n","!pip install faiss-cpu\n","\n","\n","#@markdown Whether to enable tensorboard\n","tensorboard_on = True  #@param {type:\"boolean\"}\n","\n","if tensorboard_on:\n","  %load_ext tensorboard\n","  %tensorboard --logdir logs/44k\n","\n","\n","config_path = \"/content/EZ_RVC/dataset/configs/config_colab.json\"\n","# !ln -s \"/content/drive/MyDrive/dataset\" \"/content/EZ_RVC/dataset\"\n","\n","# from model_dir.pretrain.meta import get_speech_encoder\n","# url, output = get_speech_encoder(config_path)\n","\n","# import os\n","# if not os.path.exists(output):\n","#   !curl -L {url} -o {output}\n","\n","!python train.py -c {config_path} -m 44k -md \"/content/drive/MyDrive/dataset/44k\""]},{"cell_type":"code","execution_count":null,"metadata":{"id":"fGpa4BrR4STN"},"outputs":[],"source":["!ls"]},{"cell_type":"markdown","metadata":{"id":"oCnbX-OT897k"},"source":["# **Inference**\n","### Upload wav files from this notebook\n","### **OR**\n","### Upload to `sovits4data/raw/` in your google drive manualy (should be faster)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"daakjP-ld3VK"},"outputs":[],"source":["%cd /\n","!ls content/drive/MyDrive/dataset/44k/raw/PinkPantheress_Ice_Spice_Boys_a_liar_Almost_Studio_Acapella.wav\n","%cd /content/EZ_RVC\n","# %cd content/EZ_RVC\n","# !ls content/drive/MyDrive/dataset/44k/raw/PinkPantheress_Ice_Spice_Boys_a_liar_Almost_Studio_Acapella.wav\n","\n","# !ls model_dir/pretrain/nsf_hifigan/nsf_hifigan/model\\\n","# !ls drive/MyDrive/dataset/44k/44k/D_50000.pth\n","\n","# with opx"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"dYnKuKTIj3z1"},"outputs":[],"source":["#@title Start inference (and download)\n","\n","#@markdown # Start inference (and download)\n","\n","#@markdown Parameters see [README.MD#Inference](https://github.com/svc-develop-team/so-vits-svc#-inference)\n","\n","#@markdown\n","\n","wav_filename = \"PinkPantheress_Ice_Spice_Boys_a_liar_Almost_Studio_Acapella\"  #@param {type:\"string\"}\n","# model_filename = \"G_50000\"  #@param {type:\"string\"}\n","model_path = \"/content/drive/MyDrive/dataset/44k/44k/G_85250.pth\" #@param {type:\"string\"}\n","speaker = \"sza\"  #@param {type:\"string\"}\n","trans = \"0\"  #@param {type:\"string\"}\n","cluster_infer_ratio = \"0\"  #@param {type:\"string\"}\n","auto_predict_f0 = True  #@param {type:\"boolean\"}\n","apf = \"\"\n","if auto_predict_f0:\n","  apf = \" -a \"\n","\n","f0_predictor = \"crepe\" #@param [\"crepe\", \"pm\", \"dio\", \"harvest\", \"rmvpe\", \"fcpe\"]\n","\n","enhance = True  #@param {type:\"boolean\"}\n","ehc = \"\"\n","if enhance:\n","  ehc = \" -eh \"\n","#@markdown\n","\n","#@markdown Generally keep default:\n","# config_filename = \"config_colab.json\"  #@param {type:\"string\"}\n","# config_path = \"/content/EZ_RVC/configs/\" + config_filename\n","config_path = \"/content/EZ_RVC/dataset/configs/config_colab.json\"\n","\n","from model_dir.pretrain.meta import get_speech_encoder\n","url, output = get_speech_encoder(config_path)\n","\n","import os\n","\n","if f0_predictor == \"rmvpe\" and not os.path.exists(\"./pretrain/rmvpe.pt\"):\n","  !curl -L https://huggingface.co/datasets/ylzz1997/rmvpe_pretrain_model/resolve/main/rmvpe.pt -o pretrain/rmvpe.pt\n","\n","if f0_predictor == \"fcpe\" and not os.path.exists(\"./pretrain/fcpe.pt\"):\n","  !curl -L https://huggingface.co/datasets/ylzz1997/rmvpe_pretrain_model/resolve/main/fcpe.pt -o pretrain/fcpe.pt\n","\n","if not os.path.exists(output):\n","  !curl -L {url} -o {output}\n","\n","kmeans_filenname = \"kmeans_10000.pt\"  #@param {type:\"string\"}\n","kmeans_path = \"/content/EZ_RVC/logs/44k/\" + kmeans_filenname\n","slice_db = \"-40\"  #@param {type:\"string\"}\n","wav_format = \"flac\"  #@param {type:\"string\"}\n","\n","key = \"auto\" if auto_predict_f0 else f\"{trans}key\"\n","cluster_name = \"\" if cluster_infer_ratio == \"0\" else f\"_{cluster_infer_ratio}\"\n","isdiffusion = \"sovits\"\n","wav_output = f\"/content/EZ_RVC/results/{wav_filename}_{key}_{speaker}{cluster_name}_{isdiffusion}_{f0_predictor}.{wav_format}\"\n","\n","%cd /content/EZ_RVC/\n","!pip install faiss-cpu\n","!python inference_main.py -n {wav_filename} -m {model_path} -s {speaker} -t {trans} -cr {cluster_infer_ratio} -c {config_path} -cm {kmeans_path} -sd {slice_db} -wf {wav_format} {apf} --f0_predictor={f0_predictor} {ehc}\n","\n","#@markdown\n","\n","#@markdown If you dont want to download from here, uncheck this.\n","download_after_inference = True  #@param {type:\"boolean\"}\n","\n","if download_after_inference:\n","  from google.colab import files\n","  files.download(wav_output)"]}],"metadata":{"accelerator":"GPU","colab":{"machine_shape":"hm","provenance":[{"file_id":"1mJ3W0kOE_7jvrKv26--pkC4AZaKEnsmt","timestamp":1693067475504},{"file_id":"10OCs4B1xL2I4kI5hx8aVXhFp6LqTQfU5","timestamp":1692792411828}],"authorship_tag":"ABX9TyOXPIj164id1D2+HzVbVMti"},"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"}},"nbformat":4,"nbformat_minor":0}